@{
    Layout = "~/Views/Shared/_View.cshtml";
    Page.Title = "Building";

    int id = Nistec.Types.ToInt(Request.QueryString["id"]);
    int tt = Nistec.Types.ToInt(Request.QueryString["tt"]);
    int pid = Nistec.Types.ToInt(Request.QueryString["pid"]);
    int cid = Nistec.Types.ToInt(Request.QueryString["cid"]);
}
@section head {
    @Scripts.Render("~/bundles/jqx")
    <script type="text/javascript" src="~/Scripts/app/dateFormat.js"></script>
    <link rel="stylesheet" href="~/Scripts/app/app-form.css" type="text/css" />

    <style type="text/css">
        td {
            padding: 4px;
        }

            td.signature {
                padding: 0px;
                width: 30%;
                text-align: center;
            }

        .tab-border {
            border: solid 1px #efe7e7;
        }

        hr {
            display: block;
            height: 1px;
            border: 0;
            border-top: 1px solid #000;
            margin: 1em 0;
            padding: 0;
        }

        .input-num {
            width: 100px;
        }

        .td-combo {
            margin-bottom: 2px;
            vertical-align: bottom;
        }

        h3 {
            font-weight: bolder;
        }

        h4 {
            color: #1379c3;
        }

        h5 {
            color: #1379c3;
        }
    </style>
}

@section scripts {
    <script type="text/javascript">


    $(document).ready(function () {
        JSON.useDateParser();


        var allowEdit = ('@ViewBag.UserRole' == 9) ? 1 : 0;


        app_jqxform.CreateDateTimeInput("ContractDate");
        app_jqxform.CreateDateTimeInput("DateEndContract");
        app_jqxform.CreateDateTimeInput("DateEndOption1");
        app_jqxform.CreateDateTimeInput("DateEndOption2");


        var purposeAdapter = app_jqxcombos.createComboAdapter("PurposeId", "PurposeName", "Property_Type", '@Url.Action("GetPurposeView", "Building")', 155);

        var srcAdapter = app_jqx.createDataAdapter("UserId", "DisplayName", '@Url.Action("GetAgentList", "Common")');

        app_jqxcombos.setComboSourceAdapter("UserId", "DisplayName", "AgentId", srcAdapter, 155, 200);
        app_jqxcombos.setComboSourceAdapter("UserId", "DisplayName", "Payment_In_Item_1", srcAdapter, 155, 200);
        app_jqxcombos.setComboSourceAdapter("UserId", "DisplayName", "Payment_In_Item_2", srcAdapter, 155, 200);
        app_jqxcombos.setComboSourceAdapter("UserId", "DisplayName", "Payment_In_Item_3", srcAdapter, 155, 200);
        app_jqxcombos.setComboSourceAdapter("UserId", "DisplayName", "Payment_In_Item_4", srcAdapter, 155, 200);

        var srcTransId;
        var srcUploadKey;


        JSON.useDateParser();
        var theme = 'Arctic';
        // prepare the data
        var source =
        {
            datatype: "json",
            id: 'TransId',
            type: 'POST',
            url: '@Url.Action("GetTransaction", "Crm")'

        };
        source.data = { 'id': '@id', 'trans_type': '@tt', 'parent_id': '@pid', 'contact_id': '@cid' };

        var dataAdapter = new $.jqx.dataAdapter(source, {
            loadComplete: function (record) {

                app_jqxform.loadDataForm("form", record);

                srcTransId = record.TransId;
               
                if (record.Trans_Status==3) {
                    $("#submit").hide();
                    $("#reset").hide();
                    $("#cancel").hide();
                    $("#spn_cancel").text(" - מבוטל");
                }
                else if (app.toInt(srcTransId, 0) > 0) {

                    if ('@ViewBag.UserRole' == 9) {
                        $("#submit").show();
                        $("#reset").show();
                        $("#cancel").show();
                    }
                    else {
                        $("#submit").hide();
                        $("#reset").hide();
                        $("#cancel").hide();
                    }
                }
                else {
                    $("#print").hide();
                    $("#cancel").hide();
                }

                //srcUploadKey = record.UploadKey;
                $("#AgentId").jqxComboBox({ disabled: true });
                $("#ContractDate").val(formatJsonShortDate(record.ContractDate));
                $("#DateEndContract").val(formatJsonShortDate(record.DateEndContract));
                $("#DateEndOption1").val(formatJsonShortDate(record.DateEndOption1));
                $("#DateEndOption2").val(formatJsonShortDate(record.DateEndOption2));
                app_jqxcombos.selectComboBoxValue("Property_Type", record.Property_Type);
                //sum_RentValue();
                //sum_SaleValue();
                sum_Value_Total();
            },
            loadError: function (jqXHR, status, error) {
            },
            beforeLoadComplete: function (records) {

            }
        });
        // perform data binding.
        dataAdapter.dataBind();

        //initialize validator.
        $('#form').jqxValidator({
            rtl: true,
            hintType: 'label',
            animationDuration: 0,
            rules: [
                   { input: '#Seller_Name', message: 'חובה לציין שם המוכר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Seller_ContactName', message: 'חובה לציין שם איש קשר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Seller_Address', message: 'חובה לציין כתובת המוכר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Seller_City', message: 'חובה לציין עיר המוכר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Seller_Phone', message: 'חובה לציין טלפון המוכר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Seller_Email', message: 'חובה לציין דואל המוכר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#InvoiceNo', message: 'חובה לציין מספר חשבונית!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Client_Name', message: 'חובה לציין שם חברה או הרובש\דייר!', action: 'keyup, blur', rule: 'required' },
                   { input: '#Property_Address', message: 'חובה לציין כתובת הנכס!', action: 'keyup, blur', rule: 'required' },
                   //{ input: '#ContractDate', message: 'חובה לציין מועד העסקה!', action: 'keyup, blur', rule: 'required' },
                    {
                        input: '#ContractDate', message: 'מועד העסקה אינו תקין!', action: 'keyup, blur, valueChanged', rule: function (input, commit) {
                            return app_jqxform.validateDate('ContractDate', 2000);
                        }
                    },
                     {
                         input: '#DateEndContract', message: 'תאריך סיום חוזה אינו תקין!', action: 'keyup, blur, valueChanged', rule: function (input, commit) {
                             return app_jqxform.validateDate('DateEndContract', 2000);
                         }
                     },
                  // { input: '#ComissionNet', message: 'חובה לציין את גובה העמלה!', action: 'keyup, blur', rule: 'required' },
                {
                input: '#ComissionNet', message: 'חובה לציין את גובה העמלה!', action: 'keyup, blur', rule: function () {
                    return app_jqxform.validateNumber("ComissionNet");
                }
            }
            ]
        });

        $("form").submit(function (e) {

            e.preventDefault();

            $("#TransType").val(2);

            if (confirm("האם לעדכן?") == false)
                return

            if (!validateSum())
            {
                return;
            }

            //var name = $("#CustomerName").val();

            //if (name.length > 0) {
            //    $("#ValidateResult").val("");
            //    validateLeadAccountName(name, "ValidateResult", false);
            //    if ($("#ValidateResult").val() == "false")
            //        return;
            //}
            var actionurl = $('#form').attr('action');

            var validationResult = function (isValid) {

                if (isValid) {
                    $.ajax({
                        url: actionurl,
                        type: 'post',
                        dataType: 'json',
                        data: app.serialize('#form'),
                        success: function (data) {
                            alert(data.Message);
                            if (data.Status >= 0) {
                                app_rout.redirectToTrans(data.OutputId, 2);
                            }

                        },
                        error: function (jqXHR, status, error) {
                            alert(error);
                        }
                    });
                }
                else
                    $('#linkA').trigger('click');
            }
            // Validate the Form.
            $('#form').jqxValidator('validate', validationResult);

        });

        $('#cancel').on('click', function () {

            //e.preventDefault();

            if (!validateSum()) {
                return;
            }

            var actionurl = "/Crm/CancelTransaction";
            var transId = $("#TransId").val();
            $.ajax({
                url: actionurl,
                type: 'post',
                dataType: 'json',
                data: { 'transId': transId },
                success: function (data) {
                    alert(data.Message);
                    if (data.Status >= 0) {
                        app_rout.redirectToTrans(transId, 2);
                    }

                },
                error: function (jqXHR, status, error) {
                    alert(error);
                }
            });

        });

        $("#form").on('validationSuccess', function () {
            // Display the Server's Response which came as result of the Form Submit.
            $("#form-iframe").fadeIn('fast');
        });

        $('#reset').on('click', function () {
            $("#form-iframe").html('').fadeOut('fast');
            $("#form-next").html('')
            location.reload();
        });

        $('#print').on('click', function () {
            window.print();
        });
    });

    </script>

}

<!--breadcrumb-->
<div class="breadcrumbs">
    @Html.ActionLink("Home", "Index", "Home")>
    @Html.ActionLink("Main", "Main", "Home")>
    <a href="javascript:parent.history.back()">Crm</a> >
    @ViewContext.RouteData.Values["action"].ToString()
</div>


<div class="clear"></div>

<div class="global-view">
    <div class="container">
        <div class="rtl">
            <h3>דוח סיכום עסקה מצד בעל הנכס/מוכר<span id="spn_cancel"></span></h3>
        </div>
        <div id="tag-form">
            @*@using (Html.BeginForm("UpdateBuilding", "Building", null, FormMethod.Post, new { id = "form", Class = "form" }))
                {
            *@
            <!--Html.AntiForgeryToken(), target = "form-iframe"
                          Html.ValidationSummary(true)
                              -->


            <form class="form" id="form" method="post" action="/Crm/UpdateTransaction">
                @*<input id="UploadKey" type="hidden" name="UploadKey" />
                    <input id="ValidateResult" type="hidden"/>*@
                <input id="TransType" name="TransType" value="2" type="hidden" />
                <input id="Trans_Status" name="Trans_Status" value="0" type="hidden" />
                <div class="tab-content tab-border">
                    <table>
                        <tr>
                            <td>תאריך:</td>
                            <td><input type="text" id="Creation" name="Creation" readonly="readonly" /></td>
                            <td>מס' עסקה:</td>
                            <td><input type="text" id="TransId" name="TransId" readonly /></td>
                        </tr>
                        <tr>
                            <td>מס' חשבונית לעסקה<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="InvoiceNo" name="InvoiceNo" /></td>
                            <td>סוכן:</td>
                            <td class="td-combo"><div id="AgentId" name="AgentId"></div></td>
                        </tr>
                    </table>
                </div>
                <h4>פרטי בעל הנכס/מוכר</h4>
                <div class="tab-content tab-border">
                    <input type="hidden" id="Seller_Id" name="Seller_Id" />

                    <table border="1">
                        <tr>
                            <td>שם המוכר\חברה<span class="mandatory">(*)</span>:</td>
                            <td colspan="3"><input type="text" id="Seller_Name" name="Seller_Name" style="width: 100%" /></td>
                        </tr>
                        <tr>
                            <td>איש קשר<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="Seller_ContactName" name="Seller_ContactName" /></td>
                            <td>תפקיד:</td>
                            <td><input type="text" id="Seller_ContactTitle" name="Seller_ContactTitle" /></td>
                        </tr>
                        <tr>
                            <td>כתובת<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="Seller_Address" name="Seller_Address" /></td>
                            <td>עיר<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="Seller_City" name="Seller_City" /></td>
                        </tr>
                        <tr>
                            <td>טלפון<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="Seller_Phone" name="Seller_Phone" /></td>
                            <td>פקס:</td>
                            <td><input type="text" id="Seller_Fax" name="Seller_Fax" /></td>
                        </tr>
                        <tr>
                            <td>מייל<span class="mandatory">(*)</span>:</td>
                            <td colspan="3"><input type="text" id="Seller_Email" name="Seller_Email" style="width: 100%;" /></td>
                        </tr>
                    </table>
                </div>
                <h4>צד שני של העסקה</h4>
                <div class="tab-content tab-border">
                    <input type="hidden" id="Client_Id" name="Client_Id" />
                    <table>
                        <tr>
                            <td>העסקה מתייחסת ל:</td>
                            <td colspan="3">הדייר/רוכש</td>
                        </tr>
                        <tr>
                            <td>שם הדייר\רוכש<span class="mandatory">(*)</span>:</td>
                            <td colspan="4"><input type="text" id="Client_Name" name="Client_Name" style="width: 100%;" /></td>
                        </tr>
                    </table>
                </div>
                <h4>תאור הנכס</h4>
                <div class="tab-content tab-border">
                    <table>
                        <tr>
                            <td>מס' הנכס</td>
                            <td><input type="number" id="PropertyId" name="PropertyId" readonly="readonly" /></td>
                            <td>תאריך עדכון אחרון</td>
                            <td><input type="text" id="Property_LastUpdate" name="Property_LastUpdate" readonly="readonly" /></td>
                        </tr>
                        <tr>
                            <td>שם בניין:</td>
                            <td><input type="text" id="BuildingName" name="BuildingName" /></td>
                            <td>סוג הנכס:</td>
                            <td class="td-combo">
                                <div id="Property_Type" name="Property_Type"></div>
                            </td>
                        </tr>
                        <tr>
                            <td>כתובת<span class="mandatory">(*)</span>:</td>
                            <td><input type="text" id="Property_Address" name="Property_Address" /></td>
                            <td> עיר:</td>
                            <td><input type="text" id="Property_City" name="Property_City" /></td>
                        </tr>
                        <tr>
                            <td>קומה:</td>
                            <td><input type="text" id="Property_Floor" name="Property_Floor" /></td>
                            <td>שטח -מ"ר:</td>
                            <td><input type="text" id="Property_Size" name="Property_Size" /></td>
                        </tr>
                        <tr>
                            <td>הערות:</td>
                            <td colspan="2"><input type="text" id="Property_Comment" name="Property_Comment" style="width:100%" /></td>
                            <td><input type="checkbox" id="IsNatam" name="IsNatam" />&nbsp:<span>בניין בניהול נת"מ</span></td>
                        </tr>
                    </table>
                </div>
                <h4>מהות ושווי העסקה</h4>
                <div class="tab-content tab-border">
                    <h5>שכירות:</h5>
                    <table>
                        <tr>
                            <td></td>
                            <td></td>
                            <td>מחיר ל מ''ר\לחנייה</td>
                            <td>מס' חודשים</td>
                            <td>סה''כ ב שח</td>
                        </tr>
                        <tr>
                            <td>שטח ב מ"ר:</td>
                            <td><input type="number" step="any" id="Value_Rent_Size" name="Value_Rent_Size" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Price" name="Value_Rent_Price" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Period" name="Value_Rent_Period" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Total" name="Value_Rent_Total" class="input-num" readonly /></td>
                        </tr>
                        <tr>
                            <td># מקומות חנייה:</td>
                            <td><input type="number" id="Value_Rent_Park_No" name="Value_Rent_Park_No" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Park_Price" name="Value_Rent_Park_Price" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Park_Period" name="Value_Rent_Park_Period" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Rent_Park_Total" name="Value_Rent_Park_Total" class="input-num" readonly /></td>
                        </tr>
                        <tr>
                            <td colspan="4">סה"כ:</td>
                            <td><input type="number" id="TotalRentValue" name="TotalRentValue" class="input-num" /></td>
                        </tr>
                    </table>
                    <h5>מכירה:</h5>
                    <table>
                        <tr>
                            <td></td>
                            <td></td>
                            <td>מחיר ל מ''ר\לחנייה</td>
                            <td></td>
                            <td>סה''כ ב שח</td>
                        </tr>
                        <tr>
                            <td>שטח ב מ"ר:</td>
                            <td><input type="number" step="any" id="Value_Sale_Size" name="Value_Sale_Size" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Sale_Price" name="Value_Sale_Price" class="input-num" /></td>
                            <td><input type="number" class="input-num" readonly="readonly" /></td>
                            <td><input type="number" step="any" id="Value_Sale_Total" name="Value_Sale_Total" class="input-num" readonly /></td>
                        </tr>
                        <tr>
                            <td># מקומות חנייה:</td>
                            <td><input type="number" id="Value_Sale_Park_No" name="Value_Sale_Park_No" class="input-num" /></td>
                            <td><input type="number" step="any" id="Value_Sale_Park_Price" name="Value_Sale_Park_Price" class="input-num" /></td>
                            <td><input type="number" class="input-num" readonly="readonly" /></td>
                            <td><input type="number" step="any" id="Value_Sale_Park_Total" name="Value_Sale_Park_Total" class="input-num" readonly /></td>
                        </tr>
                        <tr>
                            <td colspan="4">סה"כ:</td>
                            <td><input type="number" id="TotalSaleValue" name="TotalRentValue" class="input-num" /></td>
                        </tr>
                        <tr>
                            <td colspan="5"><hr /></td>
                        </tr>
                        <tr>
                            <td colspan="4">סה"כ שווי עסקה:</td>
                            <td><input type="number" id="TotalValue" name="TotalValue" class="input-num" /></td>
                        </tr>
                    </table>

                    <script type="text/javascript">

                        //rent property
                        $('#Value_Rent_Size').keyup(function () {
                            calc_Value_Rent_Total();
                        });
                        $('#Value_Rent_Price').keyup(function () {
                            calc_Value_Rent_Total();
                        });
                        $('#Value_Rent_Period').keyup(function () {
                            calc_Value_Rent_Total();
                        });

                        function calc_Value_Rent_Total() {
                            $('#Value_Rent_Total').val(
                            app.toFloat($('#Value_Rent_Size').val(), 0) *
                            app.toFloat($('#Value_Rent_Price').val(), 0) *
                            app.toFloat($('#Value_Rent_Period').val(), 0)
                            );
                            sum_Value_Total();
                        };

                        //rent park
                        $('#Value_Rent_Park_No').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        $('#Value_Rent_Park_Price').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        $('#Value_Rent_Park_Period').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        function calc_Value_Rent_Park_Total() {
                            $('#Value_Rent_Park_Total').val(
                           app.toFloat($('#Value_Rent_Park_No').val(), 0) *
                           app.toFloat($('#Value_Rent_Park_Price').val(), 0) *
                           app.toFloat($('#Value_Rent_Park_Period').val(), 0)
                           );
                            sum_Value_Total();
                        };

                        //Sale property
                        $('#Value_Sale_Size').keyup(function () {
                            calc_Value_Sale_Total();
                        });
                        $('#Value_Sale_Price').keyup(function () {
                            calc_Value_Sale_Total();
                        });
                        //$('#Value_Sale_Period').keyup(function () {
                        //    calc_Value_Sale_Total();
                        //});

                        function calc_Value_Sale_Total() {
                            $('#Value_Sale_Total').val(
                         app.toFloat($('#Value_Sale_Size').val(), 0) *
                         app.toFloat($('#Value_Sale_Price').val(), 0)
                         //toFloat($('#Value_Sale_Period').val(), 0)
                         );
                            sum_Value_Total();
                        };


                        //Sale park
                        $('#Value_Sale_Park_No').keyup(function () {
                            calc_Value_Sale_Park_Total();
                        });
                        $('#Value_Sale_Park_Price').keyup(function () {
                            calc_Value_Sale_Park_Total();
                        });
                        //$('#Value_Sale_Park_Period').keyup(function () {
                        //    calc_Value_Sale_Park_Total();
                        //});
                        function calc_Value_Sale_Park_Total() {
                            $('#Value_Sale_Park_Total').val(
                         app.toFloat($('#Value_Sale_Park_No').val(), 0) *
                         app.toFloat($('#Value_Sale_Park_Price').val(), 0)
                         //toFloat($('#Value_Sale_Park_Period').val(), 0)
                         );
                            sum_Value_Total();
                        };

                        function sum_RentValue() {

                            return app.toFloat($('#Value_Rent_Total').val(), 0) +
                            app.toFloat($('#Value_Rent_Park_Total').val(), 0);

                            //$('#TotalRentValue').val(
                            //toFloat($('#Value_Rent_Total').val(), 0) +
                            //toFloat($('#Value_Rent_Park_Total').val(), 0)
                            //);
                            //sum_Value_Total();
                        };

                        function sum_SaleValue() {

                            return  app.toFloat($('#Value_Sale_Total').val(), 0) +
                            app.toFloat($('#Value_Sale_Park_Total').val(), 0);

                            //$('#TotalSaleValue').val(
                            //toFloat($('#Value_Sale_Total').val(), 0) +
                            //toFloat($('#Value_Sale_Park_Total').val(), 0)
                            //);
                            //sum_Value_Total();
                        };

                        function sum_Value_Total() {

                            var sumSale=sum_SaleValue();
                            var sumRent = sum_RentValue();

                            $('#TotalSaleValue').val(sumSale);
                            $('#TotalRentValue').val(sumRent);
                            $('#TotalValue').val(sumSale + sumRent);

                            //$('#TotalValue').val(
                            //toFloat($('#Value_Rent_Total').val(), 0) +
                            //toFloat($('#Value_Rent_Park_Total').val(), 0) +
                            //toFloat($('#Value_Sale_Total').val(), 0) +
                            //toFloat($('#Value_Sale_Park').val(), 0)
                            //);
                        };

                    </script>


                    @*<script type="text/javascript">

                        //rent property
                        $('#Value_Rent_Size').keyup(function () {
                            calc_Value_Rent_Total();
                        });
                        $('#Value_Rent_Price').keyup(function () {
                            calc_Value_Rent_Total();
                        });
                        $('#Value_Rent_Period').keyup(function () {
                            calc_Value_Rent_Total();
                        });

                        function calc_Value_Rent_Total() {
                            $('#Value_Rent_Total').val(
                            app.toFloat($('#Value_Rent_Size').val(), 0) *
                            app.toFloat($('#Value_Rent_Price').val(), 0) *
                            app.toFloat($('#Value_Rent_Period').val(), 0)
                            );
                            sum_RentValue();
                        };

                        //rent park
                        $('#Value_Rent_Park_No').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        $('#Value_Rent_Park_Price').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        $('#Value_Rent_Park_Period').keyup(function () {
                            calc_Value_Rent_Park_Total();
                        });
                        function calc_Value_Rent_Park_Total() {
                            $('#Value_Rent_Park_Total').val(
                           app.toFloat($('#Value_Rent_Park_No').val(), 0) *
                           app.toFloat($('#Value_Rent_Park_Price').val(), 0) *
                           app.toFloat($('#Value_Rent_Park_Period').val(), 0)
                           );
                            sum_RentValue();
                        };

                        function sum_RentValue() {
                            $('#TotalRentValue').val(
                            app.toFloat($('#Value_Rent_Total').val(), 0) +
                            app.toFloat($('#Value_Rent_Park_Total').val(), 0)
                            );
                            sum_Value_Total();
                        };

                        //Sale property
                        $('#Value_Sale_Size').keyup(function () {
                            calc_Value_Sale_Total();
                        });
                        $('#Value_Sale_Price').keyup(function () {
                            calc_Value_Sale_Total();
                        });
                        //$('#Value_Sale_Period').keyup(function () {
                        //    calc_Value_Sale_Total();
                        //});

                        function calc_Value_Sale_Total() {
                            $('#Value_Sale_Total').val(
                         app.toFloat($('#Value_Sale_Size').val(), 0) *
                         app.toFloat($('#Value_Sale_Price').val(), 0) 
                         //toFloat($('#Value_Sale_Period').val(), 0)
                         );
                            sum_SaleValue();
                        };


                        //Sale park
                        $('#Value_Sale_Park_No').keyup(function () {
                            calc_Value_Sale_Park_Total();
                        });
                        $('#Value_Sale_Park_Price').keyup(function () {
                            calc_Value_Sale_Park_Total();
                        });
                        //$('#Value_Sale_Park_Period').keyup(function () {
                        //    calc_Value_Sale_Park_Total();
                        //});
                        function calc_Value_Sale_Park_Total() {
                            $('#Value_Sale_Park_Total').val(
                         app.toFloat($('#Value_Sale_Park_No').val(), 0) *
                         app.toFloat($('#Value_Sale_Park_Price').val(), 0) 
                         //toFloat($('#Value_Sale_Park_Period').val(), 0)
                         );
                            sum_SaleValue();
                        };

                        function sum_SaleValue() {
                            $('#TotalSaleValue').val(
                            app.toFloat($('#Value_Sale_Total').val(), 0) +
                            app.toFloat($('#Value_Sale_Park_Total').val(), 0)
                            );
                            sum_Value_Total();
                        };

                        function sum_Value_Total() {
                            $('#TotalValue').val(
                            app.toFloat($('#Value_Rent_Total').val(), 0) +
                            app.toFloat($('#Value_Rent_Park_Total').val(), 0) +
                            app.toFloat($('#Value_Sale_Total').val(), 0) +
                            app.toFloat($('#Value_Sale_Park').val(), 0)
                            );
                        };

                    </script>*@


                    <h5>פרטים:</h5>
                    <table>
                        <tr>
                            <td>תאריך העסקה<span class="mandatory">(*)</span></td>
                            <td>תאריך סיום החוזה<span class="mandatory">(*)</span></td>
                        </tr>
                        <tr>
                            <td><div id="ContractDate" name="ContractDate"></div></td>
                            <td><div id="DateEndContract" name="DateEndContract"></div></td>
                        </tr>
                        <tr>
                            <td>תאריך סיום אופציה1</td>
                            <td>תאריך סיום אופציה2</td>
                        </tr>
                        <tr>
                            <td><div id="DateEndOption1" name="DateEndOption1"></div></td>
                            <td><div id="DateEndOption2" name="DateEndOption2"></div></td>
                        </tr>
                    </table>

                </div>
                <h4>פרטי תשלום</h4>
                <div class="tab-content tab-border">
                    <table>
                        <tr>
                            <td>גובה העמלה לפני מע"מ<span class="mandatory">(*)</span></td>
                        </tr>
                        <tr>
                            <td><input type="number" id="ComissionNet" name="ComissionNet" /></td>
                        </tr>
                    </table>

                    <table>
                        <tr>
                            <td>גורם חיצוני\הוצאות אחרות</td>
                            <td>אחוז</td>
                            <td>סכום לפני מע"מ</td>
                        </tr>
                        <tr>
                            <td><input type="text" id="Payment_Ex_Item" name="Payment_Ex_Item" /></td>
                            <td><input type="number" id="Payment_Ex_Percent" name="Payment_Ex_Percent" /></td>
                            <td><input type="number" id="Payment_Ex_Net" name="Payment_Ex_Net" readonly /></td>
                        </tr>
                    </table>
                    <h5>חלוקה בנת"מ</h5>
                    <table>
                        <tr>
                            <td>סוכן</td>
                            <td>אחוז</td>
                            <td>סכום לפני מע"מ</td>
                        </tr>
                        <tr>
                            <td class="td-combo"><div id="Payment_In_Item_1" name="Payment_In_Item_1"></div></td>
                            <td><input type="number" step="any" id="Payment_In_Percent_1" name="Payment_In_Percent_1" /></td>
                            <td><input type="number" step="any" id="Payment_In_Net_1" name="Payment_In_Net_1" readonly /></td>
                        </tr>
                        <tr>
                            <td class="td-combo"><div id="Payment_In_Item_2" name="Payment_In_Item_2"></div></td>
                            <td><input type="number" step="any" id="Payment_In_Percent_2" name="Payment_In_Percent_2" /></td>
                            <td><input type="number" step="any" id="Payment_In_Net_2" name="Payment_In_Net_2" readonly /></td>
                        </tr>
                        <tr>
                            <td class="td-combo"><div id="Payment_In_Item_3" name="Payment_In_Item_3"></div></td>
                            <td><input type="number" step="any" id="Payment_In_Percent_3" name="Payment_In_Percent_3" /></td>
                            <td><input type="number" step="any" id="Payment_In_Net_3" name="Payment_In_Net_3" readonly /></td>
                        </tr>
                        <tr>
                            <td class="td-combo"><div id="Payment_In_Item_4" name="Payment_In_Item_4"></div></td>
                            <td><input type="number" step="any" id="Payment_In_Percent_4" name="Payment_In_Percent_4" /></td>
                            <td><input type="number" step="any" id="Payment_In_Net_4" name="Payment_In_Net_4" readonly /></td>
                        </tr>
                    </table>


                    <script type="text/javascript">


                        $('#ComissionNet').keyup(function () {
                            sum_Payment();
                        });

                        $('#Payment_Ex_Percent').keyup(function () {
                            //calc_Payment_Ex_Net();


                            sum_Payment();
                        });

                        function validateSum() {

                            var sum = app.toInt($('#Payment_In_Percent_4').val(), 0) +
                                app.toInt($('#Payment_In_Percent_3').val(), 0) +
                                app.toInt($('#Payment_In_Percent_2').val(), 0) +
                                app.toInt($('#Payment_In_Percent_1').val(), 0)

                            if (sum > 100) {
                                alert("סכום סכום העמלות עולה על 100 אחוז.");
                                 return false;
                            }
                            return true;
                        }

                        function sum_Payment() {
                            calc_Payment_Ex_Net();
                            calc_Payment_In_Net_1();
                            calc_Payment_In_Net_2();
                            calc_Payment_In_Net_3();
                            calc_Payment_In_Net_4();
                        };

                        function calc_Payment_Ex_Net() {
                            $('#Payment_Ex_Net').val(
                           app.toFloat($('#ComissionNet').val(), 0) *
                           app.toFloat($('#Payment_Ex_Percent').val(), 0) / 100
                           );
                        };


                        $('#Payment_In_Percent_1').keyup(function () {
                            calc_Payment_In_Net_1();
                            validateSum();
                        });

                        function calc_Payment_In_Net_1() {
                            $('#Payment_In_Net_1').val(
                            (app.toFloat($('#ComissionNet').val(), 0) - app.toFloat($('#Payment_Ex_Net').val(), 0)) *
                            app.toFloat($('#Payment_In_Percent_1').val(), 0) / 100
                            );
                        };


                        $('#Payment_In_Percent_2').keyup(function () {
                            calc_Payment_In_Net_2();
                            validateSum();
                        });

                        function calc_Payment_In_Net_2() {
                            $('#Payment_In_Net_2').val(
                            (app.toFloat($('#ComissionNet').val(), 0) - app.toFloat($('#Payment_Ex_Net').val(), 0)) *
                            app.toFloat($('#Payment_In_Percent_2').val(), 0) / 100
                            );
                        };


                        $('#Payment_In_Percent_3').keyup(function () {
                            calc_Payment_In_Net_3();
                            validateSum();
                        });

                        function calc_Payment_In_Net_3() {
                            $('#Payment_In_Net_3').val(
                            (app.toFloat($('#ComissionNet').val(), 0) - app.toFloat($('#Payment_Ex_Net').val(), 0)) *
                            app.toFloat($('#Payment_In_Percent_3').val(), 0) / 100
                            );
                        };

                        $('#Payment_In_Percent_4').keyup(function () {
                            calc_Payment_In_Net_4();
                            validateSum();
                        });

                        function calc_Payment_In_Net_4() {
                            $('#Payment_In_Net_4').val(
                            (app.toFloat($('#ComissionNet').val(), 0) - app.toFloat($('#Payment_Ex_Net').val(), 0)) *
                            app.toFloat($('#Payment_In_Percent_4').val(), 0) / 100
                            );
                        };
                    </script>

                </div>
                <div class="form-group">
                    <label class="column">
                        הערות:
                    </label><br />
                    <textarea id="Comment" name="Comment" class="textarea-mid"></textarea>
                </div>
                <div style="height:10px"></div>
                <div style="width:70%; display:block">
                    <div style="float:left;width:20%; text-align:center">
                        <hr />
                        <span>חתימת המתווך</span>
                    </div>
                    <div style="float: right; width: 20%; text-align: center">
                        <hr />
                        <span>חתימת המנהל</span>
                    </div>
                </div>
                <div style="height:10px; clear:both"></div>
                <div>
                    <input id="submit" type="submit" value="עדכון" class="btn-default btn2" />
                    <input id="reset" type="reset" value="רענון" class="btn-default btn2" />
                    <input id="print" type="button" value="הדפסה" class="btn-default btn2" />
                    <input id="cancel" type="button" value="ביטול" class="btn-default btn2" />
                </div>
            </form>
            @*}*@
        </div>
    </div>
</div>
<!--end of content-wrapper-->
<script type="text/javascript">
   app_menu.activeLayoutMenu("liLeads");
</script>

