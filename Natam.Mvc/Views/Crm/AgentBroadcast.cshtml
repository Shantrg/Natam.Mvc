@{
    Layout = "~/Views/Shared/_View.cshtml";
    Page.Title = "Building";
   
}

@section head {


    @Scripts.Render("~/bundles/jqx")
    @Scripts.Render("~/bundles/jqxgrid")

   
    <script type="text/javascript">
    $(document).ready(function () {
        var me = this;
   
        @*var dealAdapter = app_jqxcombos.createComboCheckAdapter("DealId", "DealName", "DealType", '@Url.Action("GetDealView", "Building")');

        var purposeAdapter = app_jqxcombos.createComboCheckAdapter("PurposeId", "PurposeName", "PurposeType", '@Url.Action("GetPurposeView", "Building")');

        var areaAdapter = app_jqxcombos.createComboCheckAdapter("AreaId", "AreaName", "AreaType", '@Url.Action("GetAreaViewAll", "Building")', 0, 200, false);

        var sizesAdapter = app_jqxcombos.createComboAdapter("SizeId", "SizeTitle", "RequestSize", '@Url.Action("GetRequestSize", "Common")', 0, 200, false);*@


            var dealValues = { "1": "מכירה", "2": "שכירות"};
            var purposeValues = {   "1": "משרדים", "2": "תעשיה", "4": "מסחר", "8": "מחסנים", "16": "מגורים", "32": "חניה"};
            var areaValues = { "1": "מרכז", "2": "צפון", "4": "דרום", "8": "ירושלים", "16": "שפלה", "32": "שרון"};//, "7": "תל אביב"};

            app_jqxcombos.createCheckListFromArray(dealValues, "listDealType", 200, 80,"DealType");
            app_jqxcombos.createCheckListFromArray(purposeValues, "listPurposeType", 200, 120, "PurposeType");
            app_jqxcombos.createCheckListFromArray(areaValues, "listAreaType", 200, 120, "AreaType");
    
        
            //$('#listDealType').on('checkChange', function (event) {
            //    if (!$('#allDealType').is(':checked'))
            //        app_jqxcombos.listCheckBoxToInput("listTransferAgents", "TransferToAgent");

            //});

            $("#allDealType").change(function () {
                if (this.checked) {
                    $('#listDealType').jqxListBox('uncheckAll');
                    $("#DealType").val("0");
                    $('#listDealType').jqxListBox({ disabled: true });
                    //Do stuff
                }
                else {
                    $("#DealType").val("0");
                    $('#listDealType').jqxListBox({ disabled: false });
                }
            });

            $("#allPurposeType").change(function () {
                if (this.checked) {
                    $('#listPurposeType').jqxListBox('uncheckAll');
                    $("#PurposeType").val("0");
                    $('#listPurposeType').jqxListBox({ disabled: true });
                    //Do stuff
                }
                else {
                    $("#PurposeType").val("0");
                    $('#listPurposeType').jqxListBox({ disabled: false });
                }
            });


            $("#allAreaType").change(function () {
                if (this.checked) {
                    $('#listAreaType').jqxListBox('uncheckAll');
                    $("#AreaType").val("0");
                    $('#listAreaType').jqxListBox({ disabled: true });
                    //Do stuff
                }
                else {
                    $("#AreaType").val("0");
                    $('#listAreaType').jqxListBox({ disabled: false });
                }
            });
          
            var getDealType = function () {

                var val = $("#DealType").val();
                if (val == "0")
                    return 0;
                return app.calcBitCode(val);

            }
            var getPurposeType = function () {

                var val = $("#PurposeType").val();
                if (val == "0")
                    return 0;
                return app.calcBitCode(val);


            }
            var getAreaType = function () {

                var val = $("#AreaType").val();
                if (val == "0")
                    return 0;
                return app.calcBitCode(val);

            }

        var source =
        {
            datatype: "json",
            id: 'AgentId',
            type: 'POST',
            url: '/Crm/AgentBroadcastGet'

        };
        var dataAdapter = new $.jqx.dataAdapter(source, {
            loadComplete: function (record) {

                //app_form.loadDataForm("form", record);

                $("#AgentName").val(record.AgentName);
                               
                if (record.DealType == 0)
                    $("#DealType").val("0");
                else
                    app_jqxcombos.selectCheckList("listDealType", record.DealType, "DealType");

                if (record.Purpose == 0)
                    $("#PurposeType").val("0");
                else
                    app_jqxcombos.selectCheckList("listPurposeType", record.Purpose, "PurposeType");

                if (record.Area == 0)
                    $("#AreaType").val("0");
                else
                    app_jqxcombos.selectCheckList("listAreaType", record.Area, "AreaType");


                //app_select.BroadcastDealType("#DealType", record.Deal);
                //app_select.BroadcastPurposeType("#PurposeType", record.Purpose);
                //app_select.BroadcastAreaType("#AreaType", record.Area);
                app_select.BroadcastSize("#Size", record.Size);

            },
            loadError: function (jqXHR, status, error) {
            }
        });

        dataAdapter.dataBind();

        $(".reset").click(function () {
            location.reload();
        });

        $("#submit").click(function () {
            //e.preventDefault();

            var actionurl = $('#form').attr('action');
            var postData = [];

            var dealType=getDealType();
            var purposeType=getPurposeType();
            var areaType=getAreaType();

            postData.push("Area=" + areaType);
            postData.push("Purpose=" + purposeType);
            postData.push("DealType=" + dealType);
            postData.push("Size=" + $("#Size").val() );

            //alert(postData);

            
            var validationResult = function (isValid) {
                if (isValid) {
                     $.ajax({
                        url: actionurl,
                        type: 'post',
                        dataType: 'json',
                        data: postData.join("&"),
                        success: function (data) {
                            app_dialog.alert(data.Message);
                            //app_messenger.Post(data);
                            //if (data.Status >= 0) {
                                
                            //}
                        },
                        error: function (jqXHR, status, error) {
                            app_dialog.alert(error);
                        }
                    });
                }
            }
            // Validate the Form.
            $('#form').jqxValidator('validate', validationResult);
            
        });

        $('#form').jqxValidator({
            rtl: true,
            hintType: 'label',
            animationDuration: 0,
            rules: [
                    {input: '#DealType', message: 'חובה לציין סוג עסקה!', action: 'keyup, blur', rule: 'required'},
                    {input: '#PurposeType', message: 'חובה לציין סוג הנכס!', action: 'keyup, blur', rule: 'required'},
                    {input: '#AreaType', message: 'חובה לציין אזור!', action: 'keyup, blur', rule: 'required'},
                    {
                        input: '#Size', message: 'חובה לציין שטח!', action: 'select', rule: function (input) {
                            return $("#Size").val() >= 0;
                        }
                    }
            ]
        });

        
    });

    </script>
}

<!--breadcrumb-->
<div class="breadcrumbs">
@Html.ActionLink("Home", "Index", "Home")>
@Html.ActionLink("Main", "Main", "Home")>
@ViewContext.RouteData.Values["action"].ToString()
</div>

<div class="clear"></div>

<div class="global-view">

    <div class="container-box">
        <h3>עדכוני הפצה</h3>

        <div class="panel-area">
            <div class="panel-area-title">הגדרת עדכוני הפצה במייל</div>
            <form id="form" action="AgentBroadcastUpdate" method="post">
                <div class="rtl">
                    <div class="form-group">
                        <label class="column">
                            סוג עסקה:
                        </label>
                        <div id="listDealType"></div>
                        <input type="checkbox" id="allDealType" /><span>הכל</span>
                        <input type="text" id="DealType" readonly />
                    </div>
                    <div class="form-group">
                        <label class="column">
                            סוג הנכס/שימוש:
                        </label>
                        <div id="listPurposeType"></div>
                        <input type="checkbox" id="allDealType" /><span>הכל</span>
                        <input type="text" id="PurposeType" readonly />
                    </div>
                    <div class="form-group">
                        <label class="column">
                            אזור מבוקש:
                        </label>
                        <div id="listAreaType"></div>
                        <input type="checkbox" id="allDealType" /><span>הכל</span>
                        <input type="text" id="AreaType" readonly />
                    </div>
                    <div class="form-group">
                        <label class="column">
                            שטח:
                        </label>
                        <select id="Size" name="Size"></select>
                    </div>
                    <div class="form-group">
                        <label class="column">
                            סוכן:
                        </label>
                        <input id="AgentName" type="text" />
                    </div>
                    <br />
                    <input type="button" id="submit" value="עדכון" class="btn-default btn2" />
                    <input type="reset" value="נקה" class="btn-default btn2 reset" />
                </div>
            </form>


        </div>
    </div>
</div>
<script type="text/javascript">
    app_menu.activeLayoutMenu("liBuilding");
</script>



